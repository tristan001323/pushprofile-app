# Session de travail - 9 Fevrier 2026

## Resume des modifications

Cette session a porte sur plusieurs ameliorations majeures de PushProfile : contacts, filtres freelance, UX scoring, et corrections de bugs.

---

## 1. Amelioration de l'enrichissement des contacts

### Probleme initial
- Seulement 1-2 contacts retournes (uniquement CEO/Founder)
- Domaines incorrects avec Haiku (breople.com au lieu de breople.fr)
- Pas assez de contacts RH/recruteurs

### Solutions implementees

#### A. Changement de modele pour la recherche de domaine
**Fichier:** `app/api/enrich-contacts/route.ts`
- Passe de Haiku a Sonnet pour trouver les domaines d'entreprise
- Sonnet est plus fiable pour les entreprises francaises
- Cout: ~$0.0005/requete

#### B. Detection de pattern d'email
Detecte automatiquement le format d'email de l'entreprise:
- `first.last` ‚Üí jean.dupont@company.com
- `firstlast` ‚Üí jeandupont@company.com
- `flast` ‚Üí jdupont@company.com
- `first_last` ‚Üí jean_dupont@company.com
- etc.

Genere ensuite des emails pour les contacts sans email en utilisant ce pattern.

#### C. Extraction des recruteurs depuis les descriptions de job
- Utilise Claude Haiku pour analyser les descriptions
- Cherche les noms apres "Contact:", "Recruteur:", "Publie par:", etc.
- Genere leur email avec le pattern detecte
- Cout: ~$0.0001/requete

#### D. Emails generiques RH en fallback
Si moins de 3 contacts avec email, ajoute:
- `recrutement@domain.com`
- `rh@domain.com`
- `careers@domain.com`

### Code cle
```typescript
// Detection du pattern
function detectEmailPattern(email, firstName, lastName): EmailPattern {
  const localPart = email.split('@')[0].toLowerCase()
  if (localPart === `${first}.${last}`) return 'first.last'
  if (localPart === `${first}${last}`) return 'firstlast'
  // ...
}

// Generation d'email
function generateEmail(firstName, lastName, domain, pattern): string {
  const localParts = {
    'first.last': `${first}.${last}`,
    'firstlast': `${first}${last}`,
    // ...
  }
  return `${localParts[pattern]}@${domain}`
}
```

---

## 2. Correction du filtre Freelance

### Probleme initial
- Recherche "Freelance" ne retournait que des offres Adzuna
- Les offres ATS/Indeed etaient filtrees car `employment_type: undefined` ‚Üí mappait vers `permanent`
- Les stages s'affichaient comme "Freelance"

### Solutions implementees

**Fichier:** `app/api/process-search/[id]/route.ts`

#### A. Fix du mapping contract_type
```typescript
// AVANT (bug)
contract_type: job.employment_type || 'permanent'

// APRES (fix)
contract_type: job.employment_type === 'contract' ? 'contract'
  : job.employment_type === 'internship' ? 'internship'
  : job.employment_type === 'full_time' ? 'permanent'
  : undefined  // Garde undefined au lieu de forcer permanent
```

#### B. Exclusion des stages pour Freelance
```typescript
if (isFreelanceSearch && jobContractType === 'stage') {
  return false  // Exclut les stages des recherches Freelance
}
```

#### C. Affichage correct
```typescript
function getDisplayContractType(rawType, requestedTypes): string {
  const isFreelanceSearch = requestedTypes.some(t => t.toLowerCase() === 'freelance')
  if (isFreelanceSearch) {
    if (normalized === 'stage') return 'Stage'
    if (!rawType || normalized === null) return 'Freelance'  // Affiche Freelance, pas CDI
  }
  // ...
}
```

---

## 3. Correction du redirect Adzuna (seiza.co)

### Probleme
Toutes les offres Adzuna redirigeaient vers seiza.co au lieu du vrai site de l'offre.

### Solution
**Fichier:** `app/api/redirect/[jobId]/route.ts`

Ajout de seiza.co et autres domaines publicitaires a la liste de blocage:
```typescript
const blockedDomains = [
  'seiza.co', 'seiza.fr', 'doubleclick', 'googlesyndication',
  'googleadservices', 'facebook.com/tr', 'analytics', 'tracking',
  'pixel', 'ad.', 'ads.', 'criteo', 'taboola', 'outbrain',
  'pubmatic', 'rubiconproject'
]
```

---

## 4. Refonte UX du scoring

### Probleme
- Pourcentages demotivants (35% = decourageant)
- Couleurs flashy agressives
- Labels negatifs ("Faible correspondance")

### Solution
**Fichier:** `app/searches/[id]/page.tsx`

#### Nouveau systeme: Match Strength Dots

| Score | Dots | Label |
|-------|------|-------|
| 90%+ | ‚óè‚óè‚óè‚óè‚óè | Pour vous |
| 75%+ | ‚óè‚óè‚óè‚óè‚óã | Tres pertinent |
| 60%+ | ‚óè‚óè‚óè‚óã‚óã | Pertinent |
| 40%+ | ‚óè‚óè‚óã‚óã‚óã | A explorer |
| <40% | ‚óè‚óã‚óã‚óã‚óã | *(pas de label)* |

#### Code du composant
```typescript
function MatchDots({ score, showLabel = false }) {
  const { dots, label, color } = getMatchStrength(score)

  return (
    <div className="flex items-center gap-2">
      <div className="flex items-center gap-0.5">
        {[1, 2, 3, 4, 5].map((i) => (
          <div
            key={i}
            className={`w-2 h-2 rounded-full ${
              i <= dots ? color.replace('text-', 'bg-') : 'bg-gray-200'
            }`}
          />
        ))}
      </div>
      {showLabel && label && (
        <span className={`text-sm font-medium ${color}`}>{label}</span>
      )}
    </div>
  )
}
```

### Avantages
- Dots moins "jugeants" que pourcentages
- Labels toujours positifs
- Focus sur le potentiel, pas le manque
- Couleurs subtiles (indigo/gris)

---

## 5. Correction du flash UI

### Probleme
"Recherche en cours..." s'affichait brievement meme pour les recherches terminees.

### Solution
**Fichier:** `app/searches/[id]/page.tsx`

```typescript
// AVANT
const [searchStatus, setSearchStatus] = useState<...>('processing')

// APRES
const [searchStatus, setSearchStatus] = useState<...>('loading')
```

---

## 6. Amelioration du loading UX

### Ajouts
**Fichier:** `app/new-search/page.tsx`

- 11 messages de chargement au lieu de 6
- Compteur de temps ecoule
- Animation pulsante
- Messages plus detailles

```typescript
const LOADING_MESSAGES = [
  { text: "Analyse du profil...", icon: "üß†" },
  { text: "Connexion aux jobboards...", icon: "üîå" },
  { text: "Recherche sur Indeed...", icon: "üîç" },
  { text: "Recherche sur les ATS...", icon: "üè¢" },
  { text: "Analyse des offres...", icon: "üìä" },
  // ... 11 messages total
]
```

---

## Fichiers modifies

| Fichier | Modifications |
|---------|--------------|
| `app/api/enrich-contacts/route.ts` | Email pattern detection, recruiter extraction, HR aliases |
| `app/api/process-search/[id]/route.ts` | Freelance filter fixes, contract type mapping |
| `app/api/redirect/[jobId]/route.ts` | Blocked domains (seiza.co) |
| `app/searches/[id]/page.tsx` | Scoring UX (dots), UI flash fix, enrichContacts update |
| `app/new-search/page.tsx` | Loading messages, timer |

---

## Couts des APIs

| Service | Cout | Usage |
|---------|------|-------|
| Decision Maker Finder (Apify) | $1/1000 contacts | Recherche contacts |
| Claude Sonnet | ~$0.0005/requete | Trouver domaine |
| Claude Haiku | ~$0.0001/requete | Extraire recruteurs |

---

## Commits

1. `Fix Data page: fetch all matches and filter client-side`
2. `Fix job scoring: same logic for all sources`
3. `Improve CV parsing and job filtering`
4. `Fix LinkedIn contractType values`
5. `Improve contact enrichment: email pattern detection + HR targeting`
6. `Extract recruiter names from job descriptions and generate emails`
7. `Redesign scoring UX: replace percentages with subtle match dots`
8. `Improve contact enrichment: simpler API input + HR email aliases`

---

## Prochaines etapes potentielles

1. **Ameliorer Decision Maker Finder** - Tester d'autres scrapers Apify pour trouver plus de contacts HR
2. **Verification d'emails** - Ajouter une API de verification (Neverbounce, Zerobounce)
3. **Export contacts** - Permettre l'export CSV des contacts enrichis
4. **Historique des contacts** - Tracker quels contacts ont ete contactes
